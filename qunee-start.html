<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        .Q-CanvasPanel .Q-Canvas:nth-child(2) {
            opacity: 0;
        }
    </style>
</head>
<body>
<div style="position: relative;width: 800px;left: 100px;">
    <div style="position: absolute; width: 800px;height:600px; top: 0px; bottom: 0px;border: 1px solid #ccc;" id="canvas"></div>

    <div id="overview" style="width: 150px;height: 120px;box-shadow: 0px 0px 15px 0px rgba(0, 0, 0, 0.2);position: absolute;right: -160px;top: 5px;background-color: #FFF;"></div>
</div>

<div id="btnOverview" title="Show Overview Panel" style="float: right;width: 100px;height: 100px;" class="btn btn-default btn-sm">
    <div class="q-icon toolbar-overview"></div>
</div>
<script type="application/javascript" src="resource/jquery-1.12.4.js"></script>
<script src="resource/dataformat/jqTool.js"></script>
<script type="application/javascript" src="resource/commons/qunee.js"></script>
<script type="application/javascript" src="resource/commons/common.js"></script>
<script src="resource/dataformat/format.js"></script>
<script src="resource/dataformat/pedigree.js"></script>
<script src="resource/svg/svgAll.js"></script>

<script>

    var bp = {                      //   bp====>  baseOption 缩写
        dynasty: [0, 0],            //get           代的范围 便利分析得到
        nodeWidth: 110,             //init          节点宽度 初始定义
        nodeHeight: 100,            //init          节点高度 初始定义
        dynastyWidth: 160,          //init          每代宽度 初始定义
        canvasWidth: 800,           //Calculation   画布绘图区域宽度    计算得到
        canvasHeight: 900,          //Calculation   画布绘图区域高度    计算的到
        maxYnums: 0,                 //Calculation   最大Y值
        data:""                      //Calculation    节点数据
    }
    $.get('resource/dataformat/data.js', function (resultData) {
        console.log(resultData);
        var listData = resultData[0].nodeTree;
        listData.push(resultData[0].nodeFirst);
        $.each(listData, function (a, b) {
            b.children = ""
        })
        bp.data=ftt.format(listData);
        creatLineTopBlock(bp);
    }, "json");

    //数据处理获得option

    var graph = new Q.Graph(canvas);
    var p = graph.toLogical(0, 0);
    graph.zoomOut(p.x, p.y);
    graph.zoomIn(p.x, p.y);
    graph.limitedBounds = {x: 0, y: 0, width: 100*160, height: 20000};
/*
    graph.limitedBounds = {x: 0, y: 0, width: 2000, height: 2000}
*/
    graph.originAtCenter = false;
    //重写滚轮事件  滚轮滚动 基于左上角放大缩小
    graph.enableWheelZoom = false;
    graph.onmousewheel = function (evt) {
        var zoominDelta = evt.delta;
        if (zoominDelta > 0) {
            return this.zoomIn(0, 0);
        }
        return this.zoomOut(0, 0);
    }
    //锁定移动功能
    graph.isMovable = function (item) {
        return (item.nameS=="noClick"||item.nameS=="noMOVE")?false:true;
    }
    graph.isSelectable = function (item) {
        return (item.nameS=="noClick")?false:true;
    }


    function createShape( join,x, y,height){//画竖着的线
        var shape = graph.createShapeNode(join, x, y);
        shape.moveTo(0, 0);
        shape.lineTo(0, height);
        shape.setStyle(Q.Styles.SHAPE_STROKE, 2);
        shape.setStyle(Q.Styles.SHAPE_STROKE_STYLE, "#e6e6e6");
        shape.setStyle(Q.Styles.LAYOUT_BY_PATH, true);
        shape.setStyle(Q.Styles.SHAPE_FILL_COLOR, null);
        shape.setStyle(Q.Styles.LINE_CAP, Q.Consts.LINE_CAP_TYPE_BUTT);
        shape.setStyle(Q.Styles.SELECTION_COLOR, "none");
        shape.name="";
        shape.nameS="noClick";
    }

    function creatLable(num,x,y,width,height,allHeight) {//画多少多少代
        var text = graph.createText("第"+num+"代",x,y);
        text.setStyle(Q.Styles.LABEL_BACKGROUND_COLOR, (num%2==0?'#fafafa':"#f5f5f5"));
        text.setStyle(Q.Styles.LABEL_COLOR, "#6d6d6d");
        text.setStyle(Q.Styles.LABEL_PADDING, 0);
        text.setStyle(Q.Styles.LABEL_FONT_SIZE, 16);
        text.setStyle(Q.Styles.LABEL_RADIUS, 0);
        text.setStyle(Q.Styles.LABEL_SIZE, new Q.Size(width, height));
        text.setStyle(Q.Styles.SELECTION_COLOR, "none");
        text.nameS="noClick";

        var text1 = graph.createText("第"+num+"代",x,allHeight/2+y);
        text1.setStyle(Q.Styles.LABEL_BACKGROUND_COLOR, "#fff");
        text1.setStyle(Q.Styles.LABEL_COLOR, "#fff");
        text1.setStyle(Q.Styles.LABEL_PADDING, 0);
        text1.setStyle(Q.Styles.LABEL_FONT_SIZE, 16);
        text1.setStyle(Q.Styles.LABEL_RADIUS, 0);
        text1.setStyle(Q.Styles.LABEL_SIZE, new Q.Size(width-1, allHeight-height));
        text1.setStyle(Q.Styles.SELECTION_COLOR, "none");
        text1.nameS="noClick";

    }

    function creatLineTopBlock(option){//底层分格+设置节点
        if(option.dynasty[1]-option.dynasty[0]<100)option.dynasty[1]=option.dynasty[0]+100;
        for(var i=option.dynasty[0];i<=option.dynasty[1];i++){
            creatLable(i,160/2+(i-option.dynasty[0])*160,48/2,160,48,20000);
            createShape(Q.Consts.LINE_JOIN_TYPE_BEVEL,(i-bp.dynasty[0]+1)*160, 0,20000);
        }
        CPC.creat(option);
    }





    //设置右上角缩略图显示
    var overview = new Q.Overview(document.getElementById('overview'));
    overview.setGraph( window.graph);

    graph.navigationType = Q.Consts.NAVIGATION_BUTTON;
</script>
</body>
</html>